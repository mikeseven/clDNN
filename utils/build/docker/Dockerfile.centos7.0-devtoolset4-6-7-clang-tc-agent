# Copyright 2016 Intel Corporation All Rights Reserved.
#
# The source code contained or described herein and all documents related
# to the source code ("Material") are owned by Intel Corporation
# or its suppliers or licensors. Title to the Material remains with
# Intel Corporation or its suppliers and licensors. The Material contains
# trade secrets and proprietary and confidential information of Intel
# or its suppliers and licensors. The Material is protected by worldwide
# copyright and trade secret laws and treaty provisions. No part
# of the Material may be used, copied, reproduced, modified, published,
# uploaded, posted, transmitted, distributed, or disclosed in any way
# without Intelâ€™s prior express written permission.
#
# No license under any patent, copyright, trade secret or other intellectual
# property right is granted to or conferred upon you by disclosure or delivery
# of the Materials, either expressly, by implication, inducement, estoppel
# or otherwise. Any license under such intellectual property rights must be
# express and approved by Intel in writing.


FROM centos:centos7.0.1406

ENV http_proxy=http://proxy-chain.intel.com:911 \
    https_proxy=http://proxy-chain.intel.com:912 \
    ftp_proxy=http://proxy-chain.intel.com:911 \
    no_proxy=intel.com,.intel.com,10.0.0.0/8,192.168.0.0/16,localhost,127.0.0.0/8,134.134.0.0/16,::1

ARG CF_BIN_URL
ARG USE_ORACLE_JAVA=y
ARG TC_SERVER_URL
ARG TC_AGENT_USER=teamcity
ARG TC_AGENT_NAME
ARG TC_AGENT_PORT=9090
ARG TC_AGENT_PROPS


COPY prepare_tc_agent_v2.sh /tmp/
RUN chmod 755 /tmp/prepare_tc_agent_v2.sh
RUN /tmp/prepare_tc_agent_v2.sh
ENV PATH="/opt/clang+llvm-3.8.0-linux-x86_64-centos6/bin:${PATH}"
COPY ssh_creds/* /home/$TC_AGENT_USER/.ssh/

ENV http_proxy= \
    https_proxy= \
    ftp_proxy= \
    no_proxy=

RUN echo -e "\n$TC_AGENT_PROPS" >> /home/$TC_AGENT_USER/buildAgent/conf/buildAgent.properties

USER $TC_AGENT_USER
WORKDIR /home/$TC_AGENT_USER
EXPOSE $TC_AGENT_PORT

ENTRYPOINT ./buildAgent/bin/agent.sh run